<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.softsociety.exam.dao.BoardDAO">

	<!--판매글 저장 -->
	<insert id="insertBoard" parameterType="Board">
		insert into market_board
		(boardnum, memberid, title, contents, category)
		values(
		    market_board_seq.nextval,
		    #{memberid},
		    #{title},
		    #{contents},
		    #{category}
		)
	</insert>
	
	<delete id="deleteBoard" parameterType="int">
		delete market_board
		where boardnum = #{boardnum}
	</delete>
	
	<select id="selectAllBoard" resultType="Board">
		select * from market_board
		where soldout = 'N'
		order by boardnum desc
	</select>

	<select id="searchBoardBySearchword" parameterType="map" resultType="Board">
		select * from market_board
		where 
		<if test='category != "all"'> 
			category=#{category} and 
		</if>
			UPPER(title) like '%' || UPPER(#{searchword}) || '%'
			order by boardnum desc
	</select>
	
	<select id="selectOne" parameterType="int" resultType="Board">
		select *
		from market_board
		where boardnum = #{boardnum}
	</select>
	
	<insert id="insertReply" parameterType="Reply">
		insert into market_reply
		(replynum, boardnum, memberid, replytext)
		values(
		    market_reply_seq.nextval
		    , #{boardnum}
		    , #{memberid}
		    , #{replytext}
		)
	</insert>
	
	<select id="selectAllReply" parameterType="int" resultType="Reply">
		select * from market_reply
		where boardnum = #{boardnum} 
		order by inputdate desc
	</select>
	
	<update id="buyItem" parameterType="map">
		update market_board
		set
		    soldout = 'Y',
		    buyerid = #{buyerid}
		where
		    boardnum = #{boardnum}
	</update>
</mapper>